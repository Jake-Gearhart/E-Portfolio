<!DOCTYPE html>
<html>
    <body>
        <div id="background"></div>
        <div style="display: flex;">
            Darken Background:
            <input id="debug-background" type="checkbox" oninput="updateDebugBackground()">Â 
        </div>
        <div id="board" onclick="removeZoom()"></div>
        <div class="board-transform"><img src="https://images.pokemontcg.io/swsh11/79_hires.png" style="position: absolute; width: 12.5%; bottom: 77.5%; left: 14%; transform: rotate(180deg)" onclick="zoom(this)"></div>
        <div class="board-transform">
            <img src="https://images.pokemontcg.io/swsh11/70_hires.png" style="position: absolute; width: 12.5%; left: 43.75%; bottom: 53.5%; transform: rotate(180deg)" onclick="zoom(this)">
            <img src="holofoil.gif" style="position: absolute; width: 12.5%; left: 43.75%; bottom: 53.5%; transform: rotate(180deg); pointer-events: none; mix-blend-mode: color-dodge">
        </div>
        <div class="board-transform"><img src="https://images.pokemontcg.io/swsh6/61_hires.png" style="position: absolute; width: 12.5%; left: 43.75%; bottom: 29%;" onclick="zoom(this)"></div>
        <div class="board-transform">
            <img src="https://images.pokemontcg.io/sv1/86_hires.png" style="position: absolute; width: 12.5%; bottom: 5%; left: 18%" onclick="zoom(this)">
            <img src="holofoil.gif" style="position: absolute; width: 12.5%; bottom: 5%; left: 18%; pointer-events: none; mix-blend-mode: color-dodge;">
        </div>
        <div class="board-transform"><img src="https://images.pokemontcg.io/swsh12/68_hires.png" style="position: absolute; width: 12.5%; bottom: 5%; left: 31.7%" onclick="zoom(this)"></div>
    </body>
</html>
<style>
    :root {
        --debug-background: none;
    }

    body {
        background-color: #1b7f64;
        color: white;
        font-family: monospace;
    }

    #background {
        position: absolute;
        display: var(--debug-background);
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        background-color: #166953;
        z-index: -1;
        pointer-events: none;
    }

    #board {
        background-image: url('board.png');
        background-repeat: no-repeat;
        background-size: 100% 100%;
        pointer-events: all !important;
    }

    .board-transform, #board {
        position: absolute;
        width: var(--board-side-length);
        height: var(--board-side-length);
        left: 0;
        bottom: 0;
        transform-origin: center bottom;
        transform: translateX(var(--board-translateX)) translateY(var(--board-translateY)) matrix3d(1,0,0,0,0,1,0,var(--board-depth-transform),0,0,1,0,0,0,0,1);
        pointer-events: none;
        z-index: 0;
        transition: all 0.4s;
    }
    .board-transform * {
        pointer-events: all;
        transition: all 0.4s;
    }

    .board-transform.zoom {
        transform: translateX(var(--board-translateX)) translateY(0);
        /* background-color: rgba(255,0,0,0.5); */
        z-index: 1000;
        /* pointer-events: all; */
    }
    .board-transform.zoom * {
        width: 40% !important;
        bottom: 20% !important;
        left: 0% !important;
        transform: rotate(0) !important;
    }

    img {
        filter: drop-shadow(0 0 min(0.5vw, 0.5vh) rgba(0,0,0,0.5))
    }
    .board-transform.zoom img {
        filter: drop-shadow(0 0 min(5vw, 5vh) black)
    }
</style>
<script>
    const css = document.documentElement.style

    let paddingTop = 0.05
    let paddingBottom = 0.15
    let maxBoardSteepness = 1.15

    function updateBoardTransform () {
        const w = Math.min(window.innerWidth, window.innerHeight * maxBoardSteepness)
        css.setProperty('--board-side-length', `${w}px`)

        const top_h = paddingTop * window.innerHeight
        const bottom_h = paddingBottom * window.innerHeight
        const h = window.innerHeight - top_h - bottom_h

        css.setProperty('--board-translateX', `${(window.innerWidth - w) / 2}px`)
        if (w < h) css.setProperty('--board-translateY', `${(w - h) / 2 - bottom_h}px`)
        else css.setProperty('--board-translateY', `${-bottom_h}px`)
        css.setProperty('--board-depth-transform', Math.min(0, (h - w) / (h * w)))
    }
    updateBoardTransform()

    window.addEventListener('resize', updateBoardTransform)

    function zoom(card) {
        removeZoom()
        card.parentElement.classList.add('zoom')
    }

    function removeZoom() {
        document.querySelectorAll('.zoom').forEach(elm => {
            console.log('test')
            elm.classList.remove('zoom')
        })
    }

    function updateDebugBackground() {
        css.setProperty('--debug-background', document.getElementById('debug-background').checked ? 'unset' : 'none')
    }
</script>
